<!DOCTYPE html>
<html>
<!-- This is an automatically generated file.  Do not edit.
   Copyright (c) 2019 Ted Unangst
  
   Permission to use, copy, modify, and distribute this software for any
   purpose with or without fee is hereby granted, provided that the above
   copyright notice and this permission notice appear in all copies.
  
   THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
   WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
   MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
   ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
   WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
   ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
   OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
   -->
<head>
  <meta charset="utf-8"/>
  <link rel="stylesheet" href="mandoc.css" type="text/css" media="all"/>
  <title>HONK(8)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">HONK(8)</td>
    <td class="head-vol">System Manager's Manual</td>
    <td class="head-rtitle">HONK(8)</td>
  </tr>
</table>
<div class="manual-text">
<section class="Sh">
<h1 class="Sh" id="NAME"><a class="permalink" href="#NAME">NAME</a></h1>
<p class="Pp"><code class="Nm">honk</code> &#x2014; <span class="Nd">honk
    administration</span></p>
</section>
<section class="Sh">
<h1 class="Sh" id="DESCRIPTION"><a class="permalink" href="#DESCRIPTION">DESCRIPTION</a></h1>
<p class="Pp">The <code class="Nm">honk</code> daemon processes messages from
    other federated servers. This is the admin manual. For user operation, see
    <a class="Xr" href="honk.1.html">honk(1)</a>.</p>
<section class="Ss">
<h2 class="Ss" id="SETUP"><a class="permalink" href="#SETUP">SETUP</a></h2>
<p class="Pp">Set up a TLS reverse proxy. <code class="Nm">honk</code> can
    listen on TCP or unix sockets, but will not terminate TLS. https is a
    required component for federation.</p>
<p class="Pp">Make sure to pass the Host header, if necessary (as for
  nginx).</p>
<div class="Bd Pp Bd-indent">
<pre>
proxy_set_header Host $http_host;
</pre>
</div>
</section>
<section class="Ss">
<h2 class="Ss" id="BUILD"><a class="permalink" href="#BUILD">BUILD</a></h2>
<p class="Pp">Building <code class="Nm">honk</code> requires a go compiler and
    libsqlite. On <span class="Ux">OpenBSD</span> this is the go and sqlite3
    packages. Other platforms may require additional development libraries or
    headers to be installed. Run make. Please be patient. Even on fast machines,
    building from source can take several seconds.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="INIT"><a class="permalink" href="#INIT">INIT</a></h2>
<p class="Pp">Run the <code class="Ic">init</code> command.</p>
<div class="Bd Bd-indent"><code class="Li">./honk init</code></div>
This will create the database and ask four questions, as well as creating the
  initial user.
<div class="Bd Pp Bd-indent">
<pre>
username: (desired username)
password: (desired password)
listenaddr: (tcp or unix: localhost:31337, /var/www/honk.sock, etc.)
servername: (public DNS name: honk.example.com)
</pre>
</div>
</section>
<section class="Ss">
<h2 class="Ss" id="OPERATION"><a class="permalink" href="#OPERATION">OPERATION</a></h2>
<p class="Pp">Run honk.</p>
<div class="Bd Bd-indent"><code class="Li">date; ./honk &gt;&gt; log
  2&gt;&amp;1</code></div>
Log messages are sent to stderr and should probably be redirected to a file.
</section>
<section class="Ss">
<h2 class="Ss" id="CUSTOMIZATION"><a class="permalink" href="#CUSTOMIZATION">CUSTOMIZATION</a></h2>
<p class="Pp">Add custom memes (stickers) to the <span class="Pa">memes</span>
    directory. Image and video files are supported.</p>
<p class="Pp">Add custom emus (emoji) to the <span class="Pa">emus</span>
    directory. Image files are supported.</p>
<p class="Pp">Site CSS may be overridden by creating a
    <span class="Pa">views/local.css</span> file. A restart is required after
    changes.</p>
<p class="Pp">Custom HTML messages may be added to select pages by using the
    <code class="Ic">admin</code> command. A restart is required after
  changes.</p>
<div class="Bd Bd-indent"><code class="Li">./honk admin</code></div>
<dl class="Bl-tag">
  <dt>server</dt>
  <dd>Displayed on the home page.</dd>
  <dt>about</dt>
  <dd>Displayed on the about page.</dd>
  <dt>login</dt>
  <dd>Displayed about the login form.</dd>
</dl>
</section>
<section class="Ss">
<h2 class="Ss" id="USER_ADMIN"><a class="permalink" href="#USER_ADMIN">USER
  ADMIN</a></h2>
<p class="Pp">New users can be added with the <code class="Ic">adduser</code>
    command. This is discouraged.</p>
<div class="Bd Bd-indent"><code class="Li">./honk adduser</code></div>
<p class="Pp">Passwords may be reset with the <code class="Ic">chpass</code>
    command.</p>
<div class="Bd Bd-indent"><code class="Li">./honk chpass username</code></div>
</section>
<section class="Ss">
<h2 class="Ss" id="MAINTENANCE"><a class="permalink" href="#MAINTENANCE">MAINTENANCE</a></h2>
<p class="Pp">The database may grow large over time. The
    <code class="Ic">cleanup</code> command exists to purge old data, by default
    30 days. This removes unreferenced, unsaved posts and attachments. It does
    not remove any original content.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="UPGRADE"><a class="permalink" href="#UPGRADE">UPGRADE</a></h2>
<p class="Pp">Stop the old honk process.</p>
<div class="Bd Bd-indent"><code class="Li">pkill honk</code></div>
Backup the database.
<div class="Bd Bd-indent"><code class="Li">cp honk.db backup.db</code></div>
Perform the upgrade with the <code class="Ic">upgrade</code> command.
<div class="Bd Bd-indent"><code class="Li">./honk upgrade</code></div>
Restart.
<div class="Bd Bd-indent"><code class="Li">./honk</code></div>
<p class="Pp">There's also a <span class="Pa">blob.db</span> file which is
    important to backup and restore.</p>
</section>
</section>
<section class="Sh">
<h1 class="Sh" id="SECURITY"><a class="permalink" href="#SECURITY">SECURITY</a></h1>
<p class="Pp"><code class="Nm">honk</code> is not currently hardened against
    SSRF, server side request forgery. Be mindful of what other services may be
    exposed via localhost or the local network.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="DEBUG"><a class="permalink" href="#DEBUG">DEBUG</a></h1>
<p class="Pp">Debug mode may be enabled or disabled by running
    <code class="Ic">debug</code> <var class="Ar">on|off</var>. In debug mode,
    secure cookies are disabled and templates are reloaded every request.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="ENVIRONMENT"><a class="permalink" href="#ENVIRONMENT">ENVIRONMENT</a></h1>
<p class="Pp">Image processing and scaling requires considerable memory. It is
    recommended to adjust the datasize ulimit to at least 1GB.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="SEE_ALSO"><a class="permalink" href="#SEE_ALSO">SEE
  ALSO</a></h1>
<p class="Pp"><a class="Xr" href="intro.1.html">intro(1)</a>,
    <a class="Xr" href="honk.1.html">honk(1)</a></p>
</section>
<section class="Sh">
<h1 class="Sh" id="CAVEATS"><a class="permalink" href="#CAVEATS">CAVEATS</a></h1>
<p class="Pp">There's no online upgrade capability. Upgrades may result in
    minutes of downtime.</p>
</section>
</div>
<table class="foot">
  <tr>
    <td class="foot-date">November 1, 2019</td>
    <td class="foot-os">OpenBSD 6.6</td>
  </tr>
</table>
</body>
</html>
